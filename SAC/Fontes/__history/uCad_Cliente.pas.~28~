unit uCad_Cliente;

interface

uses
  Windows, Messages, SysUtils, Variants, Classes, Graphics, Controls, Forms,
  Dialogs, uDm, DB, StdCtrls, ExtCtrls, Buttons, Grids, DBGrids, Mask, DBCtrls;

type
  TfCad_Cliente = class(TForm)
    Panel1: TPanel;
    Panel2: TPanel;
    Panel3: TPanel;
    Label1: TLabel;
    Label2: TLabel;
    Label3: TLabel;
    Label4: TLabel;
    dsCliente: TDataSource;
    edCodigo: TDBEdit;
    edNome: TDBEdit;
    edEmail: TDBEdit;
    dgCliente: TDBGrid;
    btNovo: TBitBtn;
    btGravar: TBitBtn;
    btCancelar: TBitBtn;
    btAlterar: TBitBtn;
    btExcluir: TBitBtn;
    btSair: TBitBtn;
    edFone: TMaskEdit;
    procedure btSairClick(Sender: TObject);
    procedure FormActivate(Sender: TObject);
    procedure dgClienteCellClick(Column: TColumn);
    procedure btNovoClick(Sender: TObject);
    procedure btGravarClick(Sender: TObject);
    procedure btExcluirClick(Sender: TObject);
    procedure btCancelarClick(Sender: TObject);
    procedure btAlterarClick(Sender: TObject);
    procedure dsClienteStateChange(Sender: TObject);
  private
    { Private declarations }
  public
    { Public declarations }
  end;

var
  fCad_Cliente: TfCad_Cliente;

implementation

{$R *.dfm}

procedure TfCad_Cliente.btAlterarClick(Sender: TObject);
begin
     dm.tbCliente.Edit;
     edNome.SetFocus;
end;

procedure TfCad_Cliente.btCancelarClick(Sender: TObject);
begin
     dm.tbCliente.Cancel;
     dm.tbCliente.First;

     edNome.Enabled:= false;
      edFone.Enabled:= false;
      edEmail.Enabled:= false;
     edNome.Clear;
     edFone.Clear;
     edEmail.Clear;
end;

procedure TfCad_Cliente.btExcluirClick(Sender: TObject);
begin
    if (Application.MessageBox('Deseja realmente excluir?', 'Exclusão',
            MB_ICONQUESTION+MB_YESNO+MB_DEFBUTTON2)=IDYES) then
    begin
        dm.tbCliente.Delete;
        dm.trSac.Commit;
        dm.tbCliente.Active:= true;
        btCancelarClick(sender);
    end;
end;

procedure TfCad_Cliente.btGravarClick(Sender: TObject);
begin
    with dm.tbCliente do
    begin
         FieldByName('Fone').AsString:= edFone.Text;
         if State in [dsEdit, dsInsert] then
         begin
           post;
           dm.trSac.Commit;
           dm.tbCliente.Active:= true;
         end;
    end;

   btCancelarClick(sender);
end;

procedure TfCad_Cliente.btNovoClick(Sender: TObject);
var
   prox:integer;
begin
     with dm.tbCliente do
     begin
          last;
          prox:= FieldByName('codigo').AsInteger + 1;
          Append;
          FieldByName('codigo').AsInteger:= prox;
     end;

     edNome.Enabled:= true;
     edFone.Enabled:= true;
     edEmail.Enabled:= true;
     edNome.Clear;
     edEmail.Clear;
     edFone.Clear;
     edNome.SetFocus;
end;

procedure TfCad_Cliente.btSairClick(Sender: TObject);
begin
     dm.tbCliente.Cancel;
     close;
end;

procedure TfCad_Cliente.dgClienteCellClick(Column: TColumn);
begin
     edNome.Enabled:= true;
     edFone.Enabled:= true;
     edEmail.Enabled:= true;

     with (dm.tbCliente) do
     begin
         edNome.Text:= FieldByName('Nome').AsString;
         edFone.Text:= FieldByName('Fone').AsString;
         edEmail.Text:= FieldByName('Email').AsString;
     end;
end;

procedure TfCad_Cliente.dsClienteStateChange(Sender: TObject);
begin
     with dm do
     begin
       btNovo.Enabled:= dsCliente.State in [dsBrowse];
       btGravar.Enabled:= dsCliente.State in [dsInsert, dsEdit];
       btCancelar.Enabled:= dsCliente.State in [dsInsert, dsEdit];
       btAlterar.Enabled:= (dsCliente.State in [dsBrowse]) and
                            (tbCliente.RecordCount > 0) and (edNome.Enabled:= true);
       btExcluir.Enabled:= (dsCliente.State in [dsBrowse]) and
                            (tbCliente.RecordCount > 0);
     end;
end;

procedure TfCad_Cliente.FormActivate(Sender: TObject);
begin
      self.dgClienteCellClick(nil);
      edNome.Enabled:= false;
      edFone.Enabled:= false;
      edEmail.Enabled:= false;
end;

end.
